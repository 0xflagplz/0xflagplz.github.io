<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Egress &amp; Network Evasion</title>
</head><body><img height="410" src="image.png" width="500"/><br/>
<br/>
<u><b><span style="font-size: 18pt">The C2 Problem Set:</span></b></u><ul><li style="list-style-type: none">- most places have a network firewall that denies all outbound traffic</li>
<li style="list-style-type: none">- traffic will need to conform to the proxy's protocol</li>
<li style="list-style-type: none">- we also need to evade IOC looking for cobalt or other known attacks</li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"><img height="365" src="image 3.png" width="600"/></li>
<li style="list-style-type: none"/>
</ul>
<span style="font-size: 18pt"><b><u>HTTP/S Proxy Details:</u></b></span><ul><li style="list-style-type: none">Uses the IE's proxy settings for current user</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><i>this means if the user can access google.com so can you</i></li>
</ul>
</li>
<li style="list-style-type: none">Automatic NTLM auth is OK</li>
<li style="list-style-type: none">Will prompt user if proxt authentication fails</li>
<li style="list-style-type: none"/>
<li style="list-style-type: none">Use custom proxy settings if necessary</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none">set the proxy in the http beacon (<a href="../profile%20variants/page.html">Profile Variants</a>)</li>
</ul>
</li>
<li style="list-style-type: none"/>
<li style="list-style-type: none">Beware - WinlNet library may have TLS limitation incompatible with your redirector</li>
<li style="list-style-type: none"><ul><i><li style="list-style-type: none">if youre using azure but attempting to attack windows 7, the TLS could be not up to date enough</li>
<li style="list-style-type: none"/>
</i></ul>
</li>
<i><li style="list-style-type: none"/>
</i><li style="list-style-type: none"/>
</ul>
<u><b><span style="font-size: 18pt">Profile TIPS:</span></b></u><ul><li style="list-style-type: none"/>
<li style="list-style-type: none"><span style="color: #ff0000"><b><span style="font-size: 16pt">dont use public examples in production</span></b></span><span style="font-size: 14pt">- everyone fucking knows about them </span></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><span style="font-size: 16pt"><b>- use them as bases ;)</b></span></li>
</ul>
</li>
<li style="list-style-type: none"><span style="font-size: 14pt">do not allow http-get -&gt; server -&gt; output response</span></li>
<li style="list-style-type: none"><ul><i><li style="list-style-type: none">when beacon checks in</li>
</i><li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none"><span style="font-size: 14pt">do not allow http-post -&gt; server -&gt; output response</span></li>
<li style="list-style-type: none"><ul><i><li style="list-style-type: none">when the beacon sends data back to cobalt strike </li>
</i><li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none">Change URIs and use prepend to mask IOC in http-stager block</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><i><b>only if you allow staging</b></i></li>
</ul>
</li>
</ul>
<br/>
AVS observe the fixed bytes at the beginning of a data stream, it can regognize cobalt strike<ul><li style="list-style-type: none"><img height="132" src="image 2.png" width="450"/></li>
</ul>
<br/>
<ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
</ul>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</body></html>