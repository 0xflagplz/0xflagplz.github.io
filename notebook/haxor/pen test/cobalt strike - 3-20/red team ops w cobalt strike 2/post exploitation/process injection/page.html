<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Process Injection</title>
</head><body><ul><span style="font-size: 14pt"><li style="list-style-type: none"/>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><img height="348" src="image 4.png" width="550"/>		<img height="357" src="image.png" width="550"/>		<img height="366" src="image 2.png" width="550"/></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><b><li style="list-style-type: none"><i>cobalt strike gives you control via malleable C2</i></li>
</b></ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<b><li style="list-style-type: none"/>
</b><li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</span><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><span style="font-size: 14pt"><li style="list-style-type: none"><b><u>set<i/>allocator</u><i/></b><i/></li>
<i><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none">-- allows you to choose between &quot;NtMapViewOfSection&quot; and &quot;VirtualAllocEx&quot;Â  </li>
<li style="list-style-type: none">-- this is to allocate data in and copy data to a remote process</li>
</ul>
</li>
</ul>
</li>
<li style="list-style-type: none"/>
</i><li style="list-style-type: none"><b><u>transform</u></b><i/></li>
<i><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none">-- shapes content that is being injected into remote process</li>
</ul>
</li>
</ul>
</li>
<li style="list-style-type: none"/>
</i><li style="list-style-type: none"><b><u>execute</u></b><i/></li>
</span><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><span style="font-size: 14pt"><li style="list-style-type: none"><i>-- specify what you want beacon to try</i></li>
<li style="list-style-type: none"/>
</span></ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<span style="font-size: 16pt"><u><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</u></span></ul>
</li>
</ul>
</li>
</ul>
<span style="font-size: 16pt">===================================================================================================================================================<u/></span><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><span style="font-size: 16pt"><u><li style="list-style-type: none"/>
</u></span><u><li style="list-style-type: none"><span style="font-size: 20pt"><b>Memory Inject DLL Evasion</b></span><span style="font-size: 16pt"/></li>
</u><li style="list-style-type: none"><ul><span style="font-size: 16pt"><li style="list-style-type: none"><b>Behavior</b></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><i>- set <b>post-ex</b>--&gt; <b>smartinject</b>to true</i></li>
<li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none"><b>Thread Start Address</b></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><i>- Controlled by <b>process-inject</b>configuration</i></li>
<li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none"><b>Memory Permissions</b></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><i>- Controlled by<b>process-inject</b>configuration</i></li>
<li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none"><b>Memory Context</b></li>
</span><li style="list-style-type: none"><ul><span style="font-size: 16pt"><i><li style="list-style-type: none">- set <b>post-ex</b>--&gt; <b>obfuscate</b>to true</li>
<li style="list-style-type: none"/>
</i></span><i><span style="font-size: 12pt"><li style="list-style-type: none">**address to sys32 is random system to system**</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><b>but</b></li>
</ul>
</li>
</span></i><li style="list-style-type: none"><i><span style="font-size: 12pt">same for all processes, <b>so if we know it from one proc, it only changes on boot</b></span></i><span style="font-size: 16pt"/></li>
</ul>
</li>
</ul>
</li>
<span style="font-size: 16pt"><li style="list-style-type: none"/>
</span></ul>
</li>
</ul>
</li>
</ul>
<span style="font-size: 16pt">====================================================================================================================================================<u/></span><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><span style="font-size: 16pt"><u><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</u><li style="list-style-type: none"><u>PowerShell and .Net Evasion</u><span style="color: #000000">c </span></li>
</span><li style="list-style-type: none"><ul><span style="font-size: 16pt"><li style="list-style-type: none">- set <b>post-ex</b>-&gt; <b>amsi_disable</b>to true in aprofile</li>
</span><li style="list-style-type: none"><ul><li style="list-style-type: none"><i><span style="font-size: 14pt">(does not affect powershell command)</span></i><span style="font-size: 16pt"/></li>
</ul>
</li>
<span style="font-size: 16pt"><li style="list-style-type: none">- Use <b>powerpick </b>or <b>psinject</b>instead of powershell</li>
<li style="list-style-type: none">- Be aware of <b>powershell-import</b></li>
<li style="list-style-type: none"><ul><i><span style="font-size: 14pt"><li style="list-style-type: none">- creates a localhost-only web server</li>
<li style="list-style-type: none">- prepends a download cradle to each command </li>
</span></i><li style="list-style-type: none"><i><span style="font-size: 14pt"><span style="color: #ffa300">- customize download cradle and PowerShell command via <b>Resouce Kit</b></span></span></i></li>
</ul>
</li>
</span></ul>
</li>
<span style="font-size: 16pt"><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</span></ul>
</li>
</ul>
</li>
</ul>
<span style="font-size: 16pt">====================================================================================================================================================<u/></span><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><span style="font-size: 16pt"><u><li style="list-style-type: none"/>
</u><li style="list-style-type: none"><u>3 Process Inject Situations:</u></li>
</span><li style="list-style-type: none"><ul><span style="font-size: 16pt"><i><b><li style="list-style-type: none">Self-Inject</li>
<li style="list-style-type: none">Fors&amp;Run</li>
</b></i><li style="list-style-type: none"><i><b>Remote Inject</b></i></li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"><img height="215" src="image 3.png" width="500"/></li>
<li style="list-style-type: none"/>
</span><li style="list-style-type: none"><span style="font-size: 16pt">AVs will look for functions which have a start address which is not backed by a module on disk</span><span style="font-size: 14pt"/></li>
<span style="font-size: 14pt"><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none">you can avoid making this by</li>
<li style="list-style-type: none"><ul><b><li style="list-style-type: none">CreateRemoteThread&quot;module!function+0x##&quot;</li>
</b><li style="list-style-type: none"><ul><li style="list-style-type: none"><b>beacon will create a thread in a suspended state, update it, then resume</b></li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li style="list-style-type: none"><img height="298" src="image 5.png" width="500"/></li>
</span></ul>
</li>
</ul>
</li>
</ul>
</li>
<span style="font-size: 14pt"><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</span><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><span style="font-size: 14pt"><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</span></ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</body></html>