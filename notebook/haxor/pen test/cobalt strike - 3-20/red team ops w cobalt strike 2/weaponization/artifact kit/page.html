<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Artifact Kit</title>
</head><body><tt><ul><b><u><span style="font-size: 28pt"><li style="list-style-type: none"/>
</span></u></b><li style="list-style-type: none"><ul><b><u><li style="list-style-type: none"><span style="font-size: 20pt">Avoid creating a thread affiliated with a module on disk</span></li>
</u></b><li style="list-style-type: none"><ul><i><span style="font-size: 16pt"><li style="list-style-type: none">- creates thread </li>
<li style="list-style-type: none">- calls function named &quot;run&quot;</li>
<li style="list-style-type: none">- function takes arg (pointer to beacon reflective dll package)</li>
<li style="list-style-type: none">- cast that to a function pointer</li>
</span></i><span style="font-size: 16pt"><li style="list-style-type: none"><i>- then calls it</i></li>
<i><li style="list-style-type: none"/>
</i></span><li style="list-style-type: none"><img height="355" src="image 9.png" width="550"/></li>
<li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none"><span style="font-size: 20pt"><b><u>Process Injection (avoid modules threads)</u></b></span></li>
<li style="list-style-type: none"><ul><i><span style="font-size: 16pt"><li style="list-style-type: none">- create suspended process (<b>including desirable start addres</b>s)</li>
<li style="list-style-type: none">- get the context</li>
</span></i><span style="font-size: 16pt"><li style="list-style-type: none"><i>- update the context to have it call desired <b>start address of payload</b></i></li>
<i><li style="list-style-type: none">- set the thread to the new <b>context</b></li>
<li style="list-style-type: none"><b>- </b>then resume (the thread will have the desired start address but call the payload)</li>
</i><li style="list-style-type: none"/>
</span></ul>
</li>
<li style="list-style-type: none"><img height="373" src="image 10.png" width="750"/></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
</ul>
<b>=============================================================================================================================================================================================</b><ul><span style="font-size: 28pt"><u><b><li style="list-style-type: none"/>
</b></u></span><li style="list-style-type: none"><span style="font-size: 28pt"><u><b>Artifact Kit:</b></u>  </span><span style="font-size: 16pt">generate exes, dlls, and service exes</span></li>
</ul>
<img height="143" src="image.png" width="550"/><br/>
<ul><li style="list-style-type: none">you can change <b>/artifact/src-common/bypass-pip.c</b></li>
<li style="list-style-type: none"><ul><b><li style="list-style-type: none">&gt; go to the bottom of the file and change this </li>
<li style="list-style-type: none"><img height="90" src="image 5.png" width="700"/></li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"><ul><li style="list-style-type: none">Example Change (we just want to change it):</li>
<li style="list-style-type: none"><img src="image 6.png"/></li>
</ul>
</li>
<li style="list-style-type: none"/>
</b><li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none">start by modifying the <b>/artifact/src-common/patch.c</b></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none">This is what the default patch.c looks like - <b>these are all very basic and <span style="color: #ff0000">recognized</span>syscalls</b></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><img height="247" src="image 7.png" width="600"/></li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</ul>
</li>
<li style="list-style-type: none"><u><span style="font-size: 16pt"><b>Example Change </b></span></u><span style="font-size: 14pt">~ largly does the exact same thing, just using different apis</span></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><img height="235" src="image 8.png" width="500"/></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<span style="font-size: 18pt"><li style="list-style-type: none"><b>&gt; ./build.sh</b> ~ once scripts have been modified</li>
</span></ul>
<br/>
<span style="font-size: 18pt">then go build you're exe and dlls like normal</span><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li style="list-style-type: none">names like Joe-PC or Joe* generally means your binary is being sandboxed</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<img height="452" src="image 9.png" width="700"/><br/>
<br/>
<br/>
<span style="font-size: 20pt">Recommend that you <b>AVOID</b></span><ul><span style="font-size: 16pt"><i><li style="list-style-type: none">use of <b>RWX</b>memory</li>
</i></span><li style="list-style-type: none"><span style="font-size: 16pt"><i>Threads with which have a start address that <b>is not </b>associated with a <b>memory mapped dll</b>or <b>your executable</b>itself</i></span></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<span style="font-size: 16pt"><li style="list-style-type: none">Here is how he meets the goals</li>
<li style="list-style-type: none">allocates memory that has RW permissions </li>
<li style="list-style-type: none">execute malicious intent</li>
<b><li style="list-style-type: none">flip it to ReadExecute when done</li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
</b></span><li style="list-style-type: none"><img height="379" src="image 11.png" width="700"/>			<img height="408" src="image 12.png" width="750"/></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"/>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
========================================================================================================================================<br/>
<br/>
<b><span style="font-size: 16pt">What does the AV think of your exe?</span></b><ul><span style="font-size: 16pt"><li style="list-style-type: none">What about unknown?</li>
</span><li style="list-style-type: none"><ul><span style="font-size: 16pt"><i><li style="list-style-type: none">- some environments default to good (not as common)</li>
<li style="list-style-type: none">- some will default to run but notify client</li>
<li style="list-style-type: none">- some environments default to big scary screen (more common)</li>
<li style="list-style-type: none">-<b>shit maybe all 3</b></li>
</i></span><li style="list-style-type: none"/>
<li style="list-style-type: none"><img height="299" src="image 2.png" width="450"/><img height="277" src="image 3.png" width="450"/></li>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<li style="list-style-type: none"/>
<b><li style="list-style-type: none"><span style="font-size: 20pt"><u>Local Analysis</u></span></li>
</b><li style="list-style-type: none"><ul><span style="font-size: 16pt"><li style="list-style-type: none">~ static</li>
<li style="list-style-type: none">~ dynamic</li>
</span><b><span style="font-size: 18pt"><li style="list-style-type: none"/>
</span></b></ul>
</li>
<span style="font-size: 18pt"><li style="list-style-type: none"><b><u>Static</u></b><span style="font-size: 14pt"/></li>
</span><li style="list-style-type: none"><ul><span style="font-size: 16pt"><li style="list-style-type: none"><b>- rule</b><b>based</b></li>
</span><li style="list-style-type: none"><ul><li style="list-style-type: none"><i><span style="font-size: 14pt">~ signature</span></i></li>
</ul>
</li>
<span style="font-size: 16pt"><li style="list-style-type: none"><b>- heuristic</b></li>
</span><li style="list-style-type: none"><ul><span style="font-size: 14pt"><i><li style="list-style-type: none">~ compile time</li>
<li style="list-style-type: none">~ compiler</li>
<li style="list-style-type: none">~ import table (what does it think itll be doing)</li>
<li style="list-style-type: none">~ metadata [name of app, whats the icon, etc] &amp; resources </li>
<li style="list-style-type: none">~ signed?</li>
</i></span><li style="list-style-type: none"><span style="font-size: 14pt"><i>~ entropy [does it look like suspicious packed data (encoded)]</i></span></li>
</ul>
</li>
<li style="list-style-type: none"><span style="font-size: 18pt"><b>- </b></span><b><span style="font-size: 16pt">correlation</span></b></li>
<li style="list-style-type: none"><ul><i><span style="font-size: 14pt"><li style="list-style-type: none">~ list of vectors of things we know about the binary</li>
<li style="list-style-type: none">~ compare this vector to library of binaries</li>
</span></i><li style="list-style-type: none"><ul><i><b><span style="font-size: 12pt"><li style="list-style-type: none">Which on is it most like? {list will include good and bad binaries}</li>
<li style="list-style-type: none"/>
</span></b></i></ul>
</li>
</ul>
</li>
</ul>
</li>
<li style="list-style-type: none"><b><u><span style="font-size: 16pt">What to do about this?</span></u></b></li>
<li style="list-style-type: none"><ul><span style="font-size: 18pt"><li style="list-style-type: none"/>
</span><span style="font-size: 16pt"><li style="list-style-type: none"><b>- rule</b><b>based</b></li>
</span><li style="list-style-type: none"><ul><span style="font-size: 14pt"><i><li style="list-style-type: none">~ obfuscate</li>
</i></span><li style="list-style-type: none"><span style="font-size: 14pt"><i>~ change it until the signature breaks</i></span></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<br/>
<span style="font-size: 16pt"><b>- heuristic</b></span><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><i><span style="font-size: 14pt"><li style="list-style-type: none">~ take metadata from an existing program</li>
<li style="list-style-type: none">~ pay attention to the IMPORT table (obfuscate the known malicious handles)</li>
</span></i><li style="list-style-type: none"><i><span style="font-size: 14pt">~ use a valid code signing certificate</span></i></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<br/>
<b><span style="font-size: 18pt">- </span><span style="font-size: 16pt">correlation</span></b><br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<span style="font-size: 18pt"><b><u>Dynamic</u></b></span><br/>
<ul><li style="list-style-type: none"><ul><span style="font-size: 14pt"><li style="list-style-type: none">starts executing in the sandbox until it hits <b>API call</b></li>
</span><li style="list-style-type: none"><ul><span style="font-size: 14pt"><li style="list-style-type: none">the idea is that it takes the api calls in <b>memory</b>until it can conclude whether its malicious</li>
<li style="list-style-type: none"/>
</span><li style="list-style-type: none"><span style="font-size: 14pt"><u><b>Drawbacks</b></u></span></li>
<li style="list-style-type: none"><ul><li style="list-style-type: none">1. time it takes </li>
<li style="list-style-type: none">2. incomplete emulation</li>
<li style="list-style-type: none"><img height="255" src="image 4.png" width="450"/></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<br/>
<br/>
<br/>
<br/>
========================================================================================================================================<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</tt></body></html>